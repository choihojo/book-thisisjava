# 14.1 멀티 스레드 개념

## 14.1.1 프로그램, 프로세스, CPU, 메인 메모리, IO

우선 본론으로 들어가기에 앞서 CS 용어의 정의를 명확히 하겠다.

- `프로그램 (Program)`: 컴퓨터가 실행할 수 있는 명령어들의 집합이다.

- `프로세스 (Process)`: 컴퓨터에서 실행 중인 프로그램이다. 각각의 프로세스는 독립된 메모리 공간을 할당받는다.

- `CPU (Central Processing Unit)`: 명령어를 실행하는 연산 장치이다.

- `메인 메모리 (Main Memory)`: 프로세스가 CPU에서 실행되기 위해 대기하는 곳이다.

- `IO (Input/Output)`: 파일을 읽고 쓰는 것, 네트워크의 어딘가와 데이터를 주고받는 것, 입출력 장치와 데이터를 주고 받는 것을 의미한다.

## 14.1.2 역사

지금부터 컴퓨터 시스템이 어떻게 발전되었는지 살펴보겠다.

가장 초창기 컴퓨터 시스템은 `단일 프로그래밍`으로, 한 번에 하나의 프로그램만 메모리에 올려놓고 실행했다. 그래서 또다른 프로그램을 실행하려면 먼저 실행하고 있던 프로그램을 종료시킬 필요가 있었다. 이러한 `단일 프로그래밍`은 CPU 사용률이 좋지 않다는 단점이 있었다. 예를 들어 1이라는 프로그램이 있다. P1 프로그램은 실행 중에 CPU를 사용하기도 하고 IO 작업을 하기도 한다. P1 프로그램이 IO 작업을 하는 동안 CPU는 아무것도 하지 않고 있다. 이처럼 CPU 성능을 제대로 활용하지 못했다.

`단일 프로그래밍`의 단점을 해결하기 위해 여러 개의 프로그램을 메모리에 올려놓고 동시에 실행시키는 `멀티 프로그래밍`이 등장했다. 현재 CPU에서 실행 중에 있던 프로세스에 IO 작업을 해야되는 상황이 오면, 다른 프로세스가 CPU에서 실행된다. 그런데 `멀티 프로그래밍`은 한 프로세스의 CPU 사용 시간이 길어지면 다른 프로세스는 계속 대기해야된다는 단점이 있었다.

`멀티 프로그래밍`의 단점을 해결하기 위해 프로세스가 CPU를 사용할 때 아주 짧은 시간 (quantum)동안만 CPU에서 실행되도록 하는 `멀티태스킹`이 등장했다. `멀티태스킹`은 `멀티 프로그래밍`과 동시에 여러 프로그램을 실행시킨다는 점에서는 같지만 CPU 시간을 아주 짧게 쪼개서 프로세스들이 번갈아가며 실행되도록 한다는 차이점이 있는 것이다. `멀티태스킹`은 프로세스의 응답 시간을 최소화시키는 것이 목적이다. 그런데 `멀티태스킹`도 하나의 프로세스가 동시에 여러 작업을 수행하지는 못한다는 단점이 있었다.

물론 하나의 프로세스를 여러 프로세스로 만들어서 실행시킬 수도 있겠지만 이건 또다른 단점이 있었다. 우선 프로세스의 컨텍스트 스위칭은 무거운 작업이다. 컨텍스트 스위칭은 CPU에서 실행되기 위해 한 프로세스에서 다른 프로세스로 교체되는 것을 의미한다. 다음으로 프로세스끼리는 데이터 공유가 까다롭다. 프로세스는 독립적인 메모리 공간을 가지기 때문이다. 또 당시에 발열 문제를 해결하기 위해 하나의 CPU 성능을 올리는 것이 아닌 듀얼 코어 CPU가 등장하기 시작했다. 하나의 CPU 안에 2개의 코어를 넣어 전체적인 성능을 향상시키는 방향으로 변화한 것이다. 이러한 듀얼 코어를 잘 활용하기 위해 등장한 것이 `멀티스레딩`이다. `멀티스레딩`은 하나의 프로세스가 동시에 여러 작업을 실행하도록 한다. 여기서 여러 작업은 `스레드`를 통해 실행된다.

`스레드`는 여러 가지 특징을 가지고 있다. 우선 프로세스는 한 개 이상의 스레드를 가질 수 있다. 다음으로 스레드는 CPU에서 실행되는 단위이다. 예전에는 프로세스가 CPU에서 실행되는 단위였지만 바뀐 것이다. 스레드가 CPU에서 실행되는 단위이기 때문에 프로세스는 기본적으로 하나의 스레드를 가진다. 또 같은 프로세스의 스레드 간의 컨텍스트 스위칭은 가벼운 작업이라는 특징이 있다. 마지막으로 스레드들은 자신들이 속한 프로세스의 메모리 영역을 공유한다. 정확히는 공유 영역이 힙에 존재한다. 공유하지 않는 스레드 고유의 영역은 스택에 존재한다.

`멀티스레딩` 등장 이후 멀티태스킹 개념도 확장되었다. 기존에는 여러 프로세스가 CPU 시간을 나눠갖는 것을 의미했다면, 이제는 여러 프로세스와 스레드가 CPU 시간을 나눠갖는 것을 의미한다.

번외로 2개 이상의 프로세서나 코어를 활용하는 시스템을 `멀티프로세싱`이라 한다.

### 참고

[프로세스, 스레드, 멀티태스킹, 멀티스레딩, 멀티프로세싱, 멀티프로그래밍, 이 모든 것을 한 방에 깔끔하게 설명합니다!! 콘텐츠 퀄리티 만족하실 겁니다!](https://youtu.be/QmtYKZC0lMU?si=smDK6lO8q49QouKM)

## 14.1.3 멀티 스레드

멀티 프로세스들은 서로 독립적이므로 하나의 프로세스에서 오류가 발생해도 다른 프로세스에게 영향을 미치지 않는다. 하지만 멀티 스레드는 프로세스 내부에서 생성되기 때문에 하나의 스레드가 예외를 발생시키면 프로세스가 종료되므로 다른 스레드에 영향을 미친다.

멀티 스레드는 데이터를 분할해서 병렬로 처리하는 곳에서 사용하기도 하고, 안드로이드 앱에서 네트워크 통신을 하기 위해 사용하기도 한다. 또한 다수의 클라이언트 요청을 처리하는 서버를 개발할 때에도 사용한다.
